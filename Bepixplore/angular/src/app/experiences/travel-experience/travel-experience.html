<div class="container py-5">
  <button class="btn btn-link text-dark p-0 mb-4" (click)="router.navigate(['/search-city'])">
    <i class="fa fa-arrow-left me-2"></i> Volver al buscador
  </button>

  <div class="mb-5">
    <h1 class="display-3 fw-bold">{{ city?.name | uppercase }}</h1>
    <p class="lead text-muted">{{ city?.country }} ‚Ä¢ Poblaci√≥n: {{ city?.population | number }}</p>
  </div>

  <div class="row">
    <div class="col-lg-8">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold">Opiniones de la comunidad</h3>

        <div class="input-group w-50">
          <span class="input-group-text bg-white border-end-0"><i class="fa fa-search"></i></span>
          <input type="text" class="form-control border-start-0"
                 placeholder="Filtrar rese√±as..."
                 [(ngModel)]="keyword" (input)="getExperiences()">
        </div>
      </div>

      <div class="d-flex gap-2 mb-4">
        <button class="btn btn-sm rounded-pill border px-3"
                [ngClass]="selectedRating === null ? 'btn-dark' : 'btn-light'"
                (click)="selectedRating = null; getExperiences()">
          Todas
        </button>
        <button class="btn btn-sm rounded-pill border px-3"
                [ngClass]="selectedRating === 1 ? 'btn-success text-white' : 'btn-light'"
                (click)="selectedRating = 1; getExperiences()">
          <i class="fa fa-thumbs-up me-1"></i> Positivas
        </button>
        <button class="btn btn-sm rounded-pill border px-3"
                [ngClass]="selectedRating === 2 ? 'btn-warning text-white' : 'btn-light'"
                (click)="selectedRating = 2; getExperiences()">
          <i class="fa fa-info-circle me-1"></i> Neutrales
        </button>
        <button class="btn btn-sm rounded-pill border px-3"
                [ngClass]="selectedRating === 3 ? 'btn-danger text-white' : 'btn-light'"
                (click)="selectedRating = 3; getExperiences()">
          <i class="fa fa-thumbs-down me-1"></i> Negativas
        </button>
      </div>

      <div *ngIf="experiences.length === 0" class="bg-light p-5 rounded-4 text-center border">
        <i class="fa fa-comments fa-3x text-secondary mb-3"></i>
        <p class="h5">No se encontraron rese√±as para "{{ keyword || city?.name }}".</p>
      </div>

      <div *ngFor="let exp of experiences" class="card shadow-sm border-0 mb-3 rounded-4">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <span class="badge rounded-pill"
                  [ngClass]="{'bg-success-subtle text-success': exp.rating === 1,
                              'bg-warning-subtle text-warning': exp.rating === 2,
                              'bg-danger-subtle text-danger': exp.rating === 3}">
              <i class="fa me-1" [ngClass]="exp.rating === 1 ? 'fa-thumbs-up' : 'fa-info-circle'"></i>
              {{ exp.rating === 1 ? 'Recomendado' : exp.rating === 2 ? 'Neutral' : 'No recomendado' }}
            </span>

            <div class="text-end">
              <small class="text-muted d-block mb-1">{{ exp.travelDate | date:'mediumDate' }}</small>
              <div class="btn-group">
                <button class="btn btn-sm btn-outline-primary border-0" (click)="prepareEdit(exp)" title="Editar">
                  <i class="fa fa-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger border-0" (click)="deleteExperience(exp.id)" title="Eliminar">
                  <i class="fa fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
          <p class="card-text fs-5">"{{ exp.description }}"</p>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <div class="card border-0 shadow-sm rounded-4 p-3 sticky-top" style="top: 20px;">
        <h4 class="fw-bold mb-4">
          {{ isEditing ? 'Editar tu experiencia' : 'Cu√©ntanos tu experiencia' }}
        </h4>

        <div class="mb-3">
          <label class="form-label small fw-bold">VALORACI√ìN</label>
          <select class="form-select border-0 bg-light" [(ngModel)]="newReview.rating">
            <option [ngValue]="1">‚≠ê Positiva</option>
            <option [ngValue]="2">üòê Neutral</option>
            <option [ngValue]="3">üòû Negativa</option>
          </select>
        </div>

        <div class="mb-3">
          <label class="form-label small fw-bold">TU EXPERIENCIA</label>
          <textarea class="form-control border-0 bg-light" rows="4"
                    placeholder="¬øC√≥mo fue tu viaje?" [(ngModel)]="newReview.description"></textarea>
        </div>

        <button class="btn w-100 py-2 rounded-pill"
                [ngClass]="isEditing ? 'btn-info text-white' : 'btn-dark'"
                [disabled]="!newReview.description"
                (click)="saveReview()">
          <i class="fa me-2" [ngClass]="isEditing ? 'fa-save' : 'fa-paper-plane'"></i>
          {{ isEditing ? 'Guardar cambios' : 'Publicar experiencia' }}
        </button>

        <button *ngIf="isEditing" class="btn btn-link btn-sm w-100 mt-2 text-secondary" (click)="resetForm()">
          Cancelar edici√≥n
        </button>
      </div>
    </div>
  </div>
</div>
